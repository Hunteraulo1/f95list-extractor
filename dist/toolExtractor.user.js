
// ==UserScript==
// @name         Tool Extractor
// @namespace    http://tampermonkey.net/
// @version      1.3.2
// @description  Extract all LC/F95z thread data
// @author       Hunteraulo
// @source       https://github.com/Hunteraulo1/f95list-extractor
// @downloadURL  https://raw.githubusercontent.com/Hunteraulo1/f95list-extractor/refs/heads/main/dist/toolExtractor.user.js
// @updateURL    https://raw.githubusercontent.com/Hunteraulo1/f95list-extractor/refs/heads/main/dist/toolExtractor.user.js
// @match        http*://lewdcorner.com/threads/*
// @match        http*://*.lewdcorner.com/threads/*
// @match        http*://f95zone.to/threads/*
// @match        http*://*.f95zone.to/threads/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=lewdcorner.com
// @grant        none
// ==/UserScript==

"use strict";(()=>{var r=()=>window.location.hostname==="f95zone.to";var T=()=>{const e=document.querySelectorAll(".tagItem")??[];return Array.from(e).map(n=>n.textContent).join(", ")};var v=()=>{const e=document.querySelector("title")?.textContent??"";const n=document.querySelector("img.bbImage")?.getAttribute("src")??"";const t=Number(window.location.pathname.split(".")[1]?.split("/")[0]);const o=n?.replace("attachments.","preview.")??"";const s=/.*-\s(.*?)\s\[/i;const l=/([\w\\']+)(?=\s-)/gi;const p=/\[([^\]]+)\]/gi;const h=e.match(l)??[];const y=e.match(s)??[];const u=e.match(p)??[];console.log("versionMatch:",u);const i=y?.[1]??"";const{status:g,type:E}=H(h);const x=u?.[0]??"";const b=T();return JSON.stringify({id:t,domain:"F95z",name:i,version:x,status:g,tags:b,type:E,ac:false,link:t?`https://f95zone.to/threads/${t}`:"",image:o},null,0)};var H=e=>{let n="";let t="";for(const o of e){switch(o){case"Abandoned":n="ABANDONNÃ‰";break;case"Completed":n="TERMINÃ‰";break;default:n="EN COURS";break}switch(o){case"Ren'Py":t="RenPy";break;case"RPGM":t="RPGM";break;case"Unity":t="Unity";break;case"Unreal Engine":t="Unreal";break;case"Flash":t="Flash";break;case"HTML":t="HTML";break;case"QSP":t="QSP";break;case"Others":t="Autre";break}}return{status:n,type:t}};var L=()=>{const e=Array.from(document.querySelectorAll('script[type="application/ld+json"]'));const n={};for(const{textContent:o}of e){try{const s=o?JSON.parse(o):{};Object.assign(n,s)}catch(s){console.error("Erreur lors du parsing JSON:",s)}}const{mainEntity:t}=n;if(!t||typeof t!=="object"){console.error("mainEntity n'est pas dÃ©fini ou mal formÃ©.");return}return t};var O=()=>{const e=L();return e?.keywords??""};var k=e=>{const n=L();const t=document.querySelector(".p-title-value")?.innerText;const o=Number(n?.url?.split(".")[2]?.split("/")[0]);const s=document.querySelector("img.bbImage")?.getAttribute("src")??"";const l=document.querySelector("dl[data-field='version'] > dd")?.textContent;const p=n?.headline?.match(/([^\[]*) /)?.[1]??"";const{status:h,type:y,typeId:u}=U(t??"");const i=o?`https://lewdcorner.com/threads/${o}`:"";if(!e){return JSON.stringify({id:o,domain:"LewdCorner",name:p,version:l,status:h,tags:n?.keywords??"",type:y,ac:false,link:i,image:s},null,0)}const g=document.querySelector('[data-field="Developer"] > dd')?.textContent??"";const E=Math.floor(new Date().getTime()/1e3);const x=document.querySelector('[data-field="dategamerelease"] > dd')?.textContent;const b=x?Math.floor(new Date(x).getTime()/1e3):0;const S=document.querySelector(".message-body .bbWrapper > div")?.textContent?.split("Overview:\n")[1]?.replaceAll('"',"''")??"";const q=document.querySelector(".js-tagList")?.textContent?.replaceAll("	","").split("\n\n\n\n").slice(1)??[];const f=[];const c=[];for(const d of q){if(d==="")continue;if(d in M){const A=M[d];if(A===0||d in f)continue;f.push(A);continue}c.push(d)}if(c[0]==="")c.shift();console.info("ðŸš€ ~ extractDataLC ~ unknownTags:",c);if(c.length>0)alert(`Tags non trouvÃ©s: ${c}`);const N=document.querySelector(".bratr-rating");const w=Number(N?.querySelectorAll(".br-selected").length??"0")+Number(N?.querySelectorAll(".br-fractional").length??"0")/2;return`BEGIN TRANSACTION; UPDATE games SET name = "${p?.replaceAll('"',"''")}", version = "${l?.replaceAll('"',"''")}", developer = "${g?.replaceAll('"',"''")}", last_updated = ${b}, score = ${w??0}, description = "${S?.replaceAll('"',"")}", tags = json_patch(tags, '[${f}]') WHERE id = (SELECT id FROM games WHERE url = '${i}' LIMIT 1); INSERT INTO games SELECT (SELECT COALESCE(MIN(id) - 1, -1) FROM games), 1, "${p?.replaceAll('"',"''")}", "${l?.replaceAll('"',"''")}", "${g?.replaceAll('"',"''")}", ${u}, 1, '${i}', ${E}, ${b}, 0, '', 0, ${w??0}, 0, '', '', 0, 0, '[]', "${S?.replaceAll('"',"")}", "n/a", '[${f}]', '[]', '', '', '[]', NULL, 0, '[]', 0, '[]', 0, '[]' WHERE NOT EXISTS (SELECT 1 FROM games WHERE url = '${i}'); COMMIT;`};var U=e=>{let n="";let t="";let o=23;if(e.includes("Abandoned")){n="ABANDONNÃ‰"}else if(e.includes("Complete")){n="TERMINÃ‰"}else{n="EN COURS"}if(e.includes("Ren'Py")){t="RenPy";o=14}else if(e.includes("RPGM")){t="RPGM";o=13}else if(e.includes("Unity")){t="Unity";o=19}else if(e.includes("Unreal Engine")){t="Unreal";o=20}else if(e.includes("Flash")){t="Flash";o=4}else if(e.includes("HTML")){t="HTML";o=5}else if(e.includes("QSP")){t="QSP";o=10}else if(e.includes("Other")){t="Autre";o=9}return{status:n,type:t,typeId:o}};var M={"2d":1,"2d game":1,"2dcg":2,"3d":3,"3d game":3,"3dcg":4,action:0,"adjustable age":0,"adult content":0,adventure:5,ahegao:6,ai:140,"ai art":140,"ai cg":140,"anal sex":7,anime:71,animated:8,arcade:0,bbw:37,bdsm:34,bestiality:35,"big ass":36,"big dick":0,"big dicks":0,"big tits":37,blackmail:38,blowjob:91,brothel:99,bukkake:39,"card game":0,casual:0,censored:40,"character creation":41,"character customization":41,cheating:42,combat:43,comic:0,corruption:44,cosplay:45,creampie:46,cuckold:90,"dating sim":47,defloration:135,dilf:48,drama:0,"dress up":0,drugs:49,drunk:49,"dystopian setting":50,ebony:70,eroge:71,erotic:0,exhibitionism:51,facial:39,fantasy:52,"female protagonist":54,femaledomination:53,femdom:53,fighting:43,fisting:7,"foot fetish":55,footjob:55,furry:56,"futa trans":57,"futa trans (avoidable)":57,"futa/trans protagonist":58,gay:59,"gay (avoidable)":59,gilf:80,"glory hole":0,gore:60,"graphic violence":60,groping:61,"group sex":62,guro:71,handholding:0,handjob:63,harem:64,headpats:0,hebe:75,horror:65,humiliation:66,humor:67,incest:68,"incest (optional)":68,"internal view":69,interracial:70,impregnation:0,"japanese game":71,"kinetic novel":72,lactation:73,lesbian:74,"lesbian (avoidable)":74,loli:75,"male protagonist":77,maledom:76,maledomination:76,management:78,masturbation:79,milf:80,"mind control":81,"mini games":100,"mobile game":82,monster:83,"monster girl":84,"multiple endings":85,"multiple penetration":86,"multiple protagonist":87,necrophilia:88,"no sexual content":89,"netori (stealing)":90,"netorase (sharing)":90,"netorare (cheating)":90,ntr:90,nudity:0,"oral sex":91,paranormal:92,parody:93,"pixel art":0,platformer:94,"point click":95,"point & click":95,possession:96,pov:97,pregnancy:98,prostitution:99,puzzle:100,rape:101,"real porn":102,religion:103,romance:104,rpg:105,sandbox:106,scat:107,"school setting":108,"sci-fi":109,"sex toys":110,"sexual content":0,"sexual harassment":111,sharing:90,shooter:112,shota:113,"side-scroller":114,simulator:115,simulation:115,sissification:116,slave:117,"sleep sex":118,"slice of life":0,"small tits":0,spanking:119,strategy:120,stripping:121,superpowers:122,swinging:123,teasing:124,teen:0,tentacles:125,"text based":126,titfuck:127,toddler:75,trainer:128,transformation:129,transgender:57,trap:130,"turn based combat":131,twins:132,urination:133,"vaginal sex":134,virgin:135,"virtual reality":136,voiced:137,vore:138,voyeurism:139,watersports:133};var $=()=>r()?T():O();var R=()=>r()?v():k(false);var D=()=>r()?v():k(true);var a=document.createElement("div");var z=()=>{a.className="extractor-panel";a.style.marginTop=r()?"8px":"14px";const e=document.querySelector("nav");e?.prepend(a);B(a);C("Extract tags",$);C("Extract all data",R);if(r())return;C("Extract for f95checker",D)};var B=e=>{const n=document.createElement("button");n.className="extractor-close";n.textContent="X";e.prepend(n);P(n)};var P=e=>{e.addEventListener("click",()=>{a.style.display="none"})};var C=(e,n)=>{const t=document.createElement("button");t.className="extractor-panelButton";t.textContent=e;a.append(t);t.addEventListener("click",()=>{j(n)})};var j=e=>{navigator.clipboard.writeText(e()).then(()=>{console.info("Text copied to clipboard")}).catch(n=>console.error("Could not copy text",n))};var m=document.createElement("button");var F=()=>{m.className="extractor-button";m.style.marginTop=r()?"8px":"14px";m.textContent="E";const e=document.querySelector("nav");e?.prepend(m);G(m)};var G=e=>{e.addEventListener("click",()=>{a.style.display="flex"})};var I=document.createElement("style");I.textContent=`.extractor-button,.extractor-panel{background-color:#1e2022;top:0;right:0;position:absolute;margin-right:14px}.extractor-button{height:48px;width:48px;border-radius:99999px;z-index:1000;border:0;color:#ba4545;font-weight:700;font-size:24px;cursor:pointer}.extractor-button:hover{background-color:#1a1b1b}.extractor-panel{width:128px;border-radius:8px;z-index:1001;display:none;flex:flex;flex-direction:column;gap:1rem;padding:1rem}.extractor-panel .extractor-close,.extractor-panel .extractor-panelButton{height:16px;background-color:#37383a;color:#ba4545;font-weight:700;font-size:8px;cursor:pointer}.extractor-panel .extractor-close{width:16px;border-radius:99999px;align-self:end;border:0}.extractor-panel .extractor-close:hover,.extractor-panel .extractor-panelButton:hover{background-color:#2b2b2c}.extractor-panel .extractor-panelButton{width:100%;border:#ba4545;border-radius:8px}`;document.head.appendChild(I);(()=>{F();z()})();})();
